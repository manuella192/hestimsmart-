<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gestion des Salles</title>
    <link rel="stylesheet" href="portails.css">
</head>
<body>

<header class="header">
    <img src="logo_hestim arrière plan bleu.png" class="logo">
    <h1>Bienvenue sur le portail Administrateur</h1>
    <button class="logout-btn" onclick="location.href='login-enseignant.html'">Déconnexion</button>
</header>

<nav class="navbar">
    <button class="nav-btn active">Salles</button>
    <button class="nav-btn" onclick="location.href='etudiants_inscrits.html'">Étudiants Inscrits</button>
    <button class="nav-btn" onclick="location.href='ajout_cours.html'">Ajouter un cours</button>
</nav>
<div class="sub-menu">
    <button class="sub-btn active" onclick="showSection('liste-salles')">Liste des Salles</button>
    <button class="sub-btn" onclick="showSection('reservations')">Réservation des salles</button>
</div>

<!-- Section Liste des Salles -->
<div id="liste-salles-section">
    <div> <h2>Liste des Salles (HESTIM Stendhal)</h2></div>
    <section class="salles-container">

    <div class="salle-card">
        <h3>Amphi A</h3>
        <p>Étage : 1</p>
        <p>Taille de la salle : Grande</p>
        <p>Nombre de places : 36</p>
        <div class="card-actions">
            <button>Voir</button><button>Modifier</button><button>Supprimer</button>
        </div>
    </div>

    <div class="salle-card">
        <h3>Salle B</h3>
        <p>Étage : 2</p>
        <p>Taille de la salle : Standard</p>
        <p>Nombre de places : 28</p>
        <div class="card-actions">
            <button>Voir</button><button>Modifier</button><button>Supprimer</button>
        </div>
    </div>

    <div class="salle-card">
        <h3>Salle F</h3>
        <p>Étage : 3</p>
        <p>Taille de la salle : Grande</p>
        <p>Nombre de places : 32</p>
        <div class="card-actions">
            <button>Voir</button><button>Modifier</button><button>Supprimer</button>
        </div>
    </div>
    <div class="salle-card">
        <h3>Salle E</h3>
        <p>Étage : 3</p>
        <p>Taille de la salle : Standard</p>
        <p>Nombre de places : 30</p>
        <div class="card-actions">
            <button>Voir</button><button>Modifier</button><button>Supprimer</button>
        </div>
    </div>

    <div class="salle-card">
        <h3>Amphi D</h3>
        <p>Étage : 2</p>
        <p>Taille de la salle : Grande</p>
        <p>Nombre de places : 64</p>
        <div class="card-actions">
            <button>Voir</button><button>Modifier</button><button>Supprimer</button>
        </div>
    </div>

    <div class="salle-card">
        <h3>Salle C</h3>
        <p>Étage : 2</p>
        <p>Taille de la salle : Grande</p>
        <p>Nombre de places : 36</p>
        <div class="card-actions">
            <button>Voir</button><button>Modifier</button><button>Supprimer</button>
        </div>
    </div>
    </section>
</div>

<!-- Section Réservations des Salles -->
<div id="reservations-section" style="display: none;">
    <div class="reservations-admin-container">
        <div class="reservations-header">
            <h2>Gestion des Réservations de Salles</h2>
            <button class="btn-add-reservation" onclick="showReservationForm()">+ Nouvelle Réservation</button>
        </div>

        <div class="reservations-filters">
            <input type="text" id="searchReservation" class="search-input" placeholder="Rechercher une réservation...">
            <select id="filterSalle" class="filter-select">
                <option value="">Toutes les salles</option>
                <option value="Amphi A">Amphi A</option>
                <option value="Salle B">Salle B</option>
                <option value="Salle F">Salle F</option>
                <option value="Salle E">Salle E</option>
                <option value="Amphi D">Amphi D</option>
                <option value="Salle C">Salle C</option>
            </select>
            <select id="filterStatus" class="filter-select">
                <option value="">Tous les statuts</option>
                <option value="Confirmée">Confirmée</option>
                <option value="En attente">En attente</option>
                <option value="Annulée">Annulée</option>
            </select>
        </div>

        <div class="reservations-table-container">
            <table class="reservations-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Salle</th>
                        <th>Réservé par</th>
                        <th>Date</th>
                        <th>Heure début</th>
                        <th>Heure fin</th>
                        <th>Raison</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="reservationsTableBody">
                    <!-- Les réservations seront affichées ici -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal pour ajouter/modifier une réservation -->
    <div id="reservationModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Nouvelle Réservation</h3>
                <span class="close-modal" onclick="closeReservationForm()">&times;</span>
            </div>
            <form id="reservationForm" onsubmit="saveReservation(event)">
                <div class="form-group">
                    <label for="modalSalle">Salle *</label>
                    <select id="modalSalle" required>
                        <option value="">Sélectionnez une salle</option>
                        <option value="Amphi A">Amphi A</option>
                        <option value="Salle B">Salle B</option>
                        <option value="Salle F">Salle F</option>
                        <option value="Salle E">Salle E</option>
                        <option value="Amphi D">Amphi D</option>
                        <option value="Salle C">Salle C</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="modalDate">Date *</label>
                        <input type="date" id="modalDate" required>
                    </div>
                    <div class="form-group">
                        <label for="modalHeureDebut">Heure début *</label>
                        <input type="time" id="modalHeureDebut" required>
                    </div>
                    <div class="form-group">
                        <label for="modalHeureFin">Heure fin *</label>
                        <input type="time" id="modalHeureFin" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="modalReservePar">Réservé par *</label>
                    <input type="text" id="modalReservePar" placeholder="Nom de l'enseignant ou cours" required>
                </div>
                <div class="form-group">
                    <label for="modalRaison">Raison de la réservation</label>
                    <textarea id="modalRaison" rows="3" placeholder="Ex: Cours d'algorithmes, Réunion, etc."></textarea>
                </div>
                <div class="form-group">
                    <label for="modalStatus">Statut</label>
                    <select id="modalStatus">
                        <option value="En attente">En attente</option>
                        <option value="Confirmée">Confirmée</option>
                        <option value="Annulée">Annulée</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeReservationForm()">Annuler</button>
                    <button type="submit" class="btn-submit">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>
</div>

<footer class="footer">

  
    <div class="footer-line"></div>

    <div class="footer-wrapper">

      
        <div class="footer-col">
            <h4>Nos formations</h4>
            <a href=""><p>Formation initiale</p></a>
           <a href=""> <p>Formation Continue</p></a>
        </div>

        <div class="footer-col">
            <h4>Contactez-nous</h4>
            <a href=""><p><i class="fa-solid fa-phone"></i> +212 670000000</p></a>
            <a href=""><p><i class="fa-solid fa-phone"></i> +212 522000000</p></a>
            <a href=""><p><i class="fa-solid fa-envelope"></i> contact@hestim.ma</p></a>
        </div>

        
        <div class="footer-col">
            <h4>HESTIM</h4>
            <a href=""><p>A propos de HESTIM</p></a>

            <div class="social-icons">
                <a href="#"><i class="fab fa-facebook"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-youtube"></i></a>
                <a href="#"><i class="fab fa-linkedin"></i></a>
            </div>
        </div>

    </div>
   
    <div class="footer-line"></div>
 Copyright © 2023 HESTIM
    <div class="footer-bottom">
        
    </div>

</footer>

<script>
    // Données des réservations (simulation)
    let reservationsData = [
        {
            id: 1,
            salle: 'Amphi A',
            reservePar: 'Prof. Ahmed BENALI',
            date: '2024-01-15',
            heureDebut: '09:00',
            heureFin: '11:00',
            raison: 'Cours d\'Algorithmes et structures de données',
            statut: 'Confirmée'
        },
        {
            id: 2,
            salle: 'Salle B',
            reservePar: 'Prof. Fatima ALAMI',
            date: '2024-01-15',
            heureDebut: '14:00',
            heureFin: '16:00',
            raison: 'Cours de Base de données',
            statut: 'Confirmée'
        },
        {
            id: 3,
            salle: 'Amphi D',
            reservePar: 'Réunion département',
            date: '2024-01-16',
            heureDebut: '10:00',
            heureFin: '12:00',
            raison: 'Réunion du département Informatique',
            statut: 'En attente'
        }
    ];

    let currentEditingId = null;

    // Fonction pour afficher/masquer les sections
    function showSection(section) {
        // Mettre à jour les boutons actifs
        document.querySelectorAll('.sub-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        // Afficher/masquer les sections
        if (section === 'liste-salles') {
            document.getElementById('liste-salles-section').style.display = 'block';
            document.getElementById('reservations-section').style.display = 'none';
        } else if (section === 'reservations') {
            document.getElementById('liste-salles-section').style.display = 'none';
            document.getElementById('reservations-section').style.display = 'block';
            loadReservations();
        }
    }

    // Charger les réservations dans le tableau
    function loadReservations() {
        const tbody = document.getElementById('reservationsTableBody');
        tbody.innerHTML = '';

        if (reservationsData.length === 0) {
            tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 20px;">Aucune réservation trouvée</td></tr>';
            return;
        }

        reservationsData.forEach(reservation => {
            const row = tbody.insertRow();
            const statusClass = reservation.statut === 'Confirmée' ? 'status-confirmed' : 
                               reservation.statut === 'En attente' ? 'status-pending' : 'status-cancelled';
            
            row.innerHTML = `
                <td>${String(reservation.id).padStart(3, '0')}</td>
                <td><strong>${reservation.salle}</strong></td>
                <td>${reservation.reservePar}</td>
                <td>${formatDate(reservation.date)}</td>
                <td>${reservation.heureDebut}</td>
                <td>${reservation.heureFin}</td>
                <td>${reservation.raison || '-'}</td>
                <td><span class="status-badge ${statusClass}">${reservation.statut}</span></td>
                <td>
                    <div class="action-buttons">
                        <button class="btn-view" onclick="viewReservation(${reservation.id})">Voir</button>
                        <button class="btn-edit" onclick="editReservation(${reservation.id})">Modifier</button>
                        <button class="btn-delete" onclick="deleteReservation(${reservation.id})">Supprimer</button>
                    </div>
                </td>
            `;
        });
    }

    // Afficher le formulaire de réservation
    function showReservationForm() {
        currentEditingId = null;
        document.getElementById('modalTitle').textContent = 'Nouvelle Réservation';
        document.getElementById('reservationForm').reset();
        document.getElementById('reservationModal').style.display = 'flex';
    }

    // Fermer le formulaire
    function closeReservationForm() {
        document.getElementById('reservationModal').style.display = 'none';
        currentEditingId = null;
    }

    // Sauvegarder une réservation
    function saveReservation(event) {
        event.preventDefault();

        const reservation = {
            salle: document.getElementById('modalSalle').value,
            date: document.getElementById('modalDate').value,
            heureDebut: document.getElementById('modalHeureDebut').value,
            heureFin: document.getElementById('modalHeureFin').value,
            reservePar: document.getElementById('modalReservePar').value,
            raison: document.getElementById('modalRaison').value,
            statut: document.getElementById('modalStatus').value
        };

        // Vérifier les conflits
        if (checkConflict(reservation, currentEditingId)) {
            alert('Cette salle est déjà réservée à cette date et heure!');
            return;
        }

        if (currentEditingId) {
            // Modifier une réservation existante
            const index = reservationsData.findIndex(r => r.id === currentEditingId);
            if (index !== -1) {
                reservationsData[index] = { ...reservation, id: currentEditingId };
                alert('Réservation modifiée avec succès!');
            }
        } else {
            // Ajouter une nouvelle réservation
            reservation.id = reservationsData.length > 0 ? Math.max(...reservationsData.map(r => r.id)) + 1 : 1;
            reservationsData.push(reservation);
            alert('Réservation créée avec succès!');
        }

        closeReservationForm();
        loadReservations();
    }

    // Vérifier les conflits de réservation
    function checkConflict(newReservation, excludeId) {
        return reservationsData.some(res => {
            if (res.id === excludeId) return false;
            if (res.salle !== newReservation.salle) return false;
            if (res.date !== newReservation.date) return false;
            if (res.statut === 'Annulée') return false;

            const newStart = timeToMinutes(newReservation.heureDebut);
            const newEnd = timeToMinutes(newReservation.heureFin);
            const resStart = timeToMinutes(res.heureDebut);
            const resEnd = timeToMinutes(res.heureFin);

            return (newStart < resEnd && newEnd > resStart);
        });
    }

    // Convertir l'heure en minutes
    function timeToMinutes(time) {
        const [hours, minutes] = time.split(':').map(Number);
        return hours * 60 + minutes;
    }

    // Voir une réservation
    function viewReservation(id) {
        const reservation = reservationsData.find(r => r.id === id);
        if (reservation) {
            alert(`Détails de la réservation:\n\n` +
                  `Salle: ${reservation.salle}\n` +
                  `Réservé par: ${reservation.reservePar}\n` +
                  `Date: ${formatDate(reservation.date)}\n` +
                  `Heure: ${reservation.heureDebut} - ${reservation.heureFin}\n` +
                  `Raison: ${reservation.raison || 'Non spécifiée'}\n` +
                  `Statut: ${reservation.statut}`);
        }
    }

    // Modifier une réservation
    function editReservation(id) {
        const reservation = reservationsData.find(r => r.id === id);
        if (reservation) {
            currentEditingId = id;
            document.getElementById('modalTitle').textContent = 'Modifier la Réservation';
            document.getElementById('modalSalle').value = reservation.salle;
            document.getElementById('modalDate').value = reservation.date;
            document.getElementById('modalHeureDebut').value = reservation.heureDebut;
            document.getElementById('modalHeureFin').value = reservation.heureFin;
            document.getElementById('modalReservePar').value = reservation.reservePar;
            document.getElementById('modalRaison').value = reservation.raison || '';
            document.getElementById('modalStatus').value = reservation.statut;
            document.getElementById('reservationModal').style.display = 'flex';
        }
    }

    // Supprimer une réservation
    function deleteReservation(id) {
        const reservation = reservationsData.find(r => r.id === id);
        if (reservation && confirm(`Êtes-vous sûr de vouloir supprimer la réservation de ${reservation.salle} ?`)) {
            reservationsData = reservationsData.filter(r => r.id !== id);
            loadReservations();
            alert('Réservation supprimée avec succès!');
        }
    }

    // Formater la date
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric' });
    }

    // Filtres et recherche
    document.getElementById('searchReservation')?.addEventListener('input', filterReservations);
    document.getElementById('filterSalle')?.addEventListener('change', filterReservations);
    document.getElementById('filterStatus')?.addEventListener('change', filterReservations);

    function filterReservations() {
        const searchTerm = document.getElementById('searchReservation').value.toLowerCase();
        const salleFilter = document.getElementById('filterSalle').value;
        const statusFilter = document.getElementById('filterStatus').value;

        const rows = document.querySelectorAll('#reservationsTableBody tr');
        rows.forEach(row => {
            const salle = row.cells[1]?.textContent || '';
            const reservePar = row.cells[2]?.textContent.toLowerCase() || '';
            const raison = row.cells[6]?.textContent.toLowerCase() || '';
            const statut = row.cells[7]?.textContent || '';

            const matchesSearch = !searchTerm || 
                salle.toLowerCase().includes(searchTerm) ||
                reservePar.includes(searchTerm) ||
                raison.includes(searchTerm);
            const matchesSalle = !salleFilter || salle.includes(salleFilter);
            const matchesStatus = !statusFilter || statut.includes(statusFilter);

            row.style.display = (matchesSearch && matchesSalle && matchesStatus) ? '' : 'none';
        });
    }

    // Fermer le modal en cliquant en dehors
    window.onclick = function(event) {
        const modal = document.getElementById('reservationModal');
        if (event.target === modal) {
            closeReservationForm();
        }
    }
</script>

</body>
</html>